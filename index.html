<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daten in TXT speichern</title>
</head>
<body>
    <h2>Speichere Daten in GitHub TXT-Datei2</h2>
    <input type="text" id="inputField" placeholder="Gib etwas ein...">
    <button onclick="saveToGitHub()">Speichern</button>

    <script>
        const GITHUB_USERNAME = "Sebi-s"; // Dein GitHub-Benutzername
        const REPO_NAME = "Sebi-s.github.io"; // Name deines Repos
        const FILE_PATH = "hhhhh.txt"; // Die Datei, die du ändern willst
        const TOKEN = "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"; // Dein Token (Achtung: Sicherheit!)

        async function saveToGitHub() {
            let input = document.getElementById("inputField").value.trim();
            if (input === "") return alert("Bitte gib etwas ein!");

            try {
                // 1️⃣ Bestehenden Datei-Inhalt abrufen
                let response = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${FILE_PATH}`, {
                    headers: { "Authorization": `token ${TOKEN}` }
                });

                if (!response.ok) {
                    console.error("Fehler beim Abrufen der Datei:", await response.text());
                    alert("Fehler beim Laden der Datei! Siehe Konsole (F12).");
                    return;
                }

                let data = await response.json();
                let sha = data.sha; // SHA ist für das Überschreiben erforderlich
                let content = atob(data.content); // Base64-Decoder

                // 2️⃣ Neuen Text zur Datei hinzufügen
                let newContent = content + `\n${input}`;
                let encodedContent = btoa(unescape(encodeURIComponent(newContent))); // Base64-Kodierung fix

                // 3️⃣ Datei aktualisieren (Commit)
                let updateResponse = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${FILE_PATH}`, {
                    method: "PUT",
                    headers: {
                        "Authorization": `token ${TOKEN}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        message: "Neuer Eintrag hinzugefügt",
                        content: encodedContent,
                        sha: sha
                    })
                });

                if (updateResponse.ok) {
                    alert("Erfolgreich gespeichert!");
                    document.getElementById("inputField").value = "";
                } else {
                    let errorMessage = await updateResponse.text();
                    console.error("Fehler beim Speichern:", errorMessage);
                    alert("Fehler beim Speichern! Siehe Konsole (F12).");
                }
            } catch (error) {
                console.error("Unerwarteter Fehler:", error);
                alert("Ein unerwarteter Fehler ist aufgetreten. Siehe Konsole (F12).");
            }
        }
    </script>
</body>
</html>
